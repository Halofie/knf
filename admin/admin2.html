<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,300,400,700" rel="stylesheet">
    <link href="../public/css/bootstrap.min.css" rel="stylesheet">
    <script src="../public/js/jquery.js"></script>
    <link rel="stylesheet" href="../public/css/admin.css">
    <link rel="icon" href="../public/Assets/pic.jpeg">
    <title>KNF - Admin Panel</title>
    <style>
        body { padding-top: 75px; /* Adjust based on your fixed-top navbar height */ }
        .sidebar { background-color: #f1f1f1; color: #e8f5e9; }
        .sidebar .btn-outline-light { border-color: #e8f5e9; color: #e8f5e9; text-align: left; width: 100%; margin-bottom: 0.5rem;}
        .sidebar .btn-outline-light:hover { background-color: #e8f5e9; color: #2e7d32; }
        .sidebar .profile { width: 100px; height: 100px; object-fit: cover; }
        .top-bar-profile-img { width: 40px; height: 40px; object-fit: cover; }
        .fixed-top-bar { background-color: #2e7d32; color: #e8f5e9; padding: 0.75rem 1rem; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .fixed-top-bar .navbar-brand-text { font-size: 1.25rem; font-weight: bold; }
        .fixed-top-bar .nav-info { font-size: 0.85rem; margin: 0; }
        .page { margin-top: 20px; /* Spacing for page content if needed, but main padding is on body */ }
        /* Remove redundant headers inside .page sections */
        .page > .darkGreen.d-fixed { display: none !important; }
    </style>
</head>
<body class="paleGreen">
    <!-- Offcanvas -->
    <div class="offcanvas offcanvas-start sidebar" tabindex="-1" id="offcanvasExample" aria-labelledby="offcanvasExampleLabel">
        <div class="offcanvas-header border-bottom border-light">
            <h5 class="offcanvas-title" id="offcanvasExampleLabel">ADMIN MENU</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
        </div>
        <div class="offcanvas-body">
            <div class="d-flex justify-content-center mb-3">
                <img src="../public/Assets/pic.jpeg" class="profile rounded-circle border border-light p-1" alt="Admin Profile">
            </div>
            <a class="btn btn-outline-light" href="#">DASHBOARD</a>
            <a class="btn btn-outline-light" href="#one">UOM MASTER</a>
            <a class="btn btn-outline-light" href="#two">CATEGORY MASTER</a>
            <a class="btn btn-outline-light" href="#three">PRODUCT MASTER</a>
            <a class="btn btn-outline-light" href="#four">ROUTE MASTER</a>
            <a class="btn btn-outline-light" href="#five">CUSTOMER MGMT</a>
            <a class="btn btn-outline-light" href="#six">SUPPLIER MGMT</a>
            <a class="btn btn-outline-light" href="#seven">WEEK MASTER</a>
            <hr class="text-light my-2">
            <a class="btn btn-outline-light" href="../knft/trunc_temp.php" target="_blank">Clear Temp Inventory</a>
            <a class="btn btn-outline-light" href="../knft/loadTempInventory.php" target="_blank">Load Temp Inventory</a>
            <a class="btn btn-outline-light" href="../knft/transferFile.php">Download Orders CSV</a>
            <hr class="text-light my-2">
            <a class="btn btn-outline-light" href="../knft/logout.php">LOGOUT</a>
        </div>
    </div>
      
    <!-- Fixed Top Bar -->
    <nav class="navbar fixed-top fixed-top-bar">
        <div class="container-fluid">
            <div class="d-flex align-items-center">
                <button class="btn p-0 me-2" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample" aria-controls="offcanvasExample">
                    <img src="../public/Assets/three-bars.svg" alt="Menu" style="width: 28px; filter: invert(1);">
                </button>
                <img src="../public/Assets/pic.jpeg" class="top-bar-profile-img rounded-circle border border-light p-0 me-2 d-none d-md-block" alt="logo">
                <span class="navbar-brand-text d-none d-md-block">KNF Admin</span>
            </div>
            
            <div class="text-center">
                <h5 id="greeting" class="m-0">WELCOME ADMIN, <span id="adminName">Admin</span></h5>
                <p class="nav-info">Current Week: <span id="currentWeekDisplay">Loading...</span></p>
            </div>

            <div class="d-flex flex-column align-items-end">
                <div class="clock nav-info"></div>
                <a href="../knft/logout.php" class="btn btn-sm btn-outline-light mt-1 d-none d-md-inline-block">Logout</a>
            </div>
        </div>
    </nav>
    
    <!-- Main Content Area -->
    <div class="container-fluid">
        <div class="text-center my-3"> <!-- Quick nav buttons -->
            <a class="btn m-1 btn-primary" href="#one">UoM Master</a>
            <a class="btn m-1 btn-primary" href="#two">Category Master</a>
            <a class="btn m-1 btn-primary" href="#three">Product Master</a>
            <a class="btn m-1 btn-primary" href="#four">Route Master</a>
            <a class="btn m-1 btn-primary" href="#five">Customer Registration</a>
            <a class="btn m-1 btn-primary" href="#six">Supplier Registration</a>
            <!-- ... other quick nav buttons ... -->
            <a class="btn m-1 btn-primary" href="#seven">Week Master</a>
            <a class="btn m-1 btn-primary" href="../knft/trunc_temp.php">clear Temp_inv</a>
            <a class="btn m-1 btn-primary" href="../knft/loadTempInventory.php">load Temp_inv</a>
            <a class="btn m-1 btn-primary" href="../knft/transferFile.php">Download Orders</a>
        </div>

        <!-- Page Sections (UOM, Category, etc.) -->
        <!-- Example: UOM Master (Page 1) -->
        <div class="page card shadow-sm mb-4" id="one">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h4 class="m-0">UOM Master</h4>
                <a class="btn btn-light btn-sm" href="#">Back to Top</a>
            </div>
            <div class="card-body">
                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-6">
                        <form class="form-control White p-3 mb-3" id="uomForm">
                            <div class="mb-2">
                                <label for="UoM" class="form-label">UoM Name</label>
                                <input type="text" class="form-control" name="UoM" id="UoM" required>
                            </div>
                            <div class="mb-2">
                                <label for="UoMID" class="form-label">UoM ID</label>
                                <input type="text" class="form-control" name="UoMID" id="UoMID" required>
                            </div>
                            <button type="submit" class="btn btn-success mt-2 submit-uom">Submit UoM</button>
                        </form>
                    </div>
                </div>
                <div id="result-uom" class="m-3 text-center"></div>
                <div class="uomHolder m-3 p-2 White w-auto h-auto">
                    <h5 class="text-center">Existing UoMs</h5>
                    <div class="table-responsive">
                        <table class="table table-success table-striped border table-hover">
                            <thead><tr><th scope="col">UoM ID</th><th scope="col">UoM Name</th><th scope="col">Action</th></tr></thead>
                            <tbody class="uom-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


        <div class="page card shadow-sm mb-4" id="two">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h4 class="m-0">Category Master</h4>
                <a class="btn btn-light btn-sm" href="#">Back to Top</a>
            </div>
            <div class="card-body">
                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-6">
                        <form class="form-control White p-3 mb-3" id="categoryForm">
                            <div class="mb-2">
                                <label for="categoryDesc" class="form-label">Category Name</label>
                                <input type="text" class="form-control" name="categoryDesc" id="categoryDesc" required>
                            </div>
                            <div class="mb-2">
                                <label for="categoryType" class="form-label">Category ID</label>
                                <input type="text" class="form-control" name="categoryType" id="categoryType" required>
                            </div>
                            <button type="submit" class="btn btn-success mt-2 submit-category">Submit Category</button>
                        </form>
                    </div>
                </div>
                <div id="result-category" class="m-3 text-center"></div>
                <div class="categoryHolder m-3 p-2 White w-auto h-auto">
                    <h5 class="text-center">Existing Categories</h5>
                    <div class="table-responsive">
                        <table class="table table-success table-striped border table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">Category ID</th>
                                    <th scope="col">Category Name</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody class="category-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


        <div class="page card shadow-sm mb-4" id="three">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h4 class="m-0">Product Master</h4>
                <a class="btn btn-light btn-sm" href="#">Back to Top</a>
            </div>
            <div class="card-body">
                <section class="row justify-content-center">
                    <div class="col-md-8 col-lg-6">
                        <div class="p-3 mb-3 border rounded bg-light">
                            <table class="table border">
                                <tbody>
                                    <tr>
                                        <th scope="row">Product:</th>
                                        <td><input type="text" class="form-control itmProduct" name="itmProduct" id="itmProduct"></td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Category</th>
                                        <td>
                                            <select class="form-select itmCategory" name="itmCategory" id="itmCategory">
                                                <!-- Options dynamically loaded -->
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">UoM</th>
                                        <td>
                                            <select class="form-select itmUoM" name="itmUoM" id="itmUoM">
                                                <!-- Options dynamically loaded -->
                                            </select>
                                        </td>
                                    </tr>
                                    <tr>
                                        <th scope="row">Rate</th>
                                        <td><input type="number" class="form-control itmRate" name="itmRate" id="itmRate"></td>
                                    </tr>
                                </tbody>
                            </table>
                            <div class="text-center mt-3">
                                <button type="button" class="btn btn-success ADDPRODUCT">Add Product</button>
                            </div>
                        </div>
                    </div>
                </section>
                <div id="result-product" class="m-3 text-center"></div>
                <div class="productHolder m-3 p-2 White w-auto h-auto">
                    <h5 class="text-center">Existing Products</h5>
                    <div class="table-responsive">
                        <table class="table table-success table-striped border table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">ID</th>
                                    <th scope="col">Category ID</th>
                                    <th scope="col">Product</th>
                                    <th scope="col">UoM ID</th>
                                    <th scope="col">Rate/UoM</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody class="product-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


        <div class="page card shadow-sm mb-4" id="four">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h4 class="m-0">Route Master</h4>
                <a class="btn btn-light btn-sm" href="#">Back to Top</a>
            </div>
            <div class="card-body">
                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-6">
                        <form class="form-control White p-3 mb-3" id="routeForm">
                            <div class="mb-2">
                                <label for="route" class="form-label">Route</label>
                                <input type="text" class="form-control" name="route" id="route" required>
                            </div>
                            <div class="mb-2">
                                <label class="form-label">Delivery Type</label><br>
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" id="pd" name="deliveryType" value="PD" required>
                                    <label class="form-check-label" for="pd">Personal Delivery</label>
                                </div>
                                <div class="form-check">
                                    <input type="radio" class="form-check-input" id="vd" name="deliveryType" value="VD" required>
                                    <label class="form-check-label" for="vd">Van Delivery</label>
                                </div>
                            </div>
                            <div class="mb-2">
                                <label for="rate" class="form-label">Rate</label>
                                <input type="number" min="0" step="1" class="form-control" name="rate" id="rate" required>
                            </div>
                            <button type="submit" class="btn btn-success mt-2 submit-route">Submit Route</button>
                        </form>
                    </div>
                </div>
                <div id="result-route" class="m-3 text-center"></div>
                <div class="routeHolder m-3 p-2 White w-auto h-auto">
                    <h5 class="text-center">Existing Routes</h5>
                    <div class="table-responsive">
                        <table class="table table-success table-striped border table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">Route</th>
                                    <th scope="col">Delivery Type</th>
                                    <th scope="col">Rate</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody class="route-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


        <div class="page card shadow-sm mb-4" id="five">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h4 class="m-0">Customer Registration</h4>
                <a class="btn btn-light btn-sm" href="#">Back to Top</a>
            </div>
            <div class="card-body">
                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-6">
                        <form class="form-control White p-3 mb-3" id="customerForm">
                            <div class="mb-2">
                                <label for="customerName" class="form-label">Customer Name</label>
                                <input type="text" class="form-control" name="customerName" id="customerName" required>
                            </div>
                            <div class="mb-2">
                                <label for="routeID" class="form-label">Route ID</label>
                                <select class="form-select routeID" name="routeID" id="routeID" required>
                                    <!-- Options dynamically loaded -->
                                </select>
                            </div>
                            <div class="mb-2">
                                <label for="contact" class="form-label">Contact No</label>
                                <input type="text" class="form-control" name="contact" id="contact" required>
                            </div>
                            <div class="mb-2">
                                <label for="alternativeContact" class="form-label">Alternative Contact No</label>
                                <input type="text" class="form-control" name="alternativeContact" id="alternativeContact">
                            </div>
                            <div class="mb-2">
                                <label for="address" class="form-label">Address</label>
                                <input type="text" class="form-control" name="address" id="address" required>
                            </div>
                            <div class="mb-2">
                                <label for="emailID" class="form-label">Email ID</label>
                                <input type="email" class="form-control" name="emailID" id="emailID" required>
                            </div>
                            <div class="mb-2">
                                <label for="password" class="form-label">Password</label>
                                <input type="password" class="form-control" name="password" id="password" required>
                            </div>
                            <button type="submit" class="btn btn-success mt-2 submit-customer">Submit</button>
                        </form>
                    </div>
                </div>
                <div id="result-customer" class="m-3 text-center"></div>
                <div class="customerHolder m-3 p-2 White w-auto h-auto">
                    <h5 class="text-center">Existing Customers</h5>
                    <div class="table-responsive">
                        <table class="table table-success table-striped border table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">Customer Name</th>
                                    <th scope="col">Route ID</th>
                                    <th scope="col">Contact No</th>
                                    <th scope="col">Alternative Contact No</th>
                                    <th scope="col">Address</th>
                                    <th scope="col">Email ID</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody class="customer-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


        <div class="page card shadow-sm mb-4" id="six">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h4 class="m-0">Supplier Form</h4>
                <a class="btn btn-light btn-sm" href="#">Back to Top</a>
            </div>
            <div class="card-body">
                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-6">
                        <form class="form-control White p-3 mb-3" id="supplierForm">
                            <div class="mb-2">
                                <label for="supplierName" class="form-label">Farmer Name</label>
                                <input type="text" class="form-control" name="supplierName" id="supplierName" required>
                            </div>
                            <div class="mb-2">
                                <label for="farmLocation" class="form-label">Farm Location</label>
                                <input type="text" class="form-control" name="farmLocation" id="farmLocation" required>
                            </div>
                            <div class="mb-2">
                                <label for="contact" class="form-label">Contact No</label>
                                <input type="text" class="form-control" name="contact" id="contact" required>
                            </div>
                            <div class="mb-2">
                                <label for="alternativeContact" class="form-label">Alternative Contact No</label>
                                <input type="text" class="form-control" name="alternativeContact" id="alternativeContact">
                            </div>
                            <div class="mb-2">
                                <label for="farmSize" class="form-label">Farm Size (In Acres)</label>
                                <input type="text" class="form-control" name="farmSize" id="farmSize" required>
                            </div>
                            <div class="mb-2">
                                <label for="emailID" class="form-label">Email ID</label>
                                <input type="email" class="form-control" name="emailID" id="emailID" required>
                            </div>
                            <div class="mb-2">
                                <label for="password" class="form-label">Password</label>
                                <input type="password" class="form-control" name="password" id="password" required>
                            </div>
                            <button type="submit" class="btn btn-success mt-2 submit-supplier">Submit Supplier</button>
                        </form>
                    </div>
                </div>
                <div id="result-supplier" class="m-3 text-center"></div>
                <div class="supplierHolder m-3 p-2 White w-auto h-auto">
                    <h5 class="text-center">Existing Suppliers</h5>
                    <div class="table-responsive">
                        <table class="table table-success table-striped border table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">Farmer Name</th>
                                    <th scope="col">Farm Location</th>
                                    <th scope="col">Contact No</th>
                                    <th scope="col">Alternative Contact No</th>
                                    <th scope="col">Farm Size</th>
                                    <th scope="col">Email ID</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody class="supplier-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>


        <div class="page card shadow-sm mb-4" id="seven">
            <div class="card-header bg-success text-white d-flex justify-content-between align-items-center">
                <h4 class="m-0">Week Master</h4>
                <a class="btn btn-light btn-sm" href="#">Back to Top</a>
            </div>
            <div class="card-body">
                <div class="row justify-content-center">
                    <div class="col-md-8 col-lg-6">
                        <form class="form-control White p-3 mb-3" id="weekForm">
                            <div class="mb-2">
                                <label for="weekDate" class="form-label">Enter Week Date (DDMMYY format)</label>
                                <input type="date" class="form-control" name="weekDate" id="weekDate" required>
                                <input type="hidden" id="formattedWeekDate" name="formattedWeekDate">
                            </div>
                            <button type="submit" class="btn btn-success mt-2 submit-week">Submit Week</button>
                        </form>
                    </div>
                </div>
                <div id="result-week" class="m-3 text-center"></div>
                <div class="weekHolder m-3 p-2 White w-auto h-auto">
                    <h5 class="text-center">Existing Weeks</h5>
                    <div class="table-responsive">
                        <table class="table table-success table-striped border table-hover">
                            <thead>
                                <tr>
                                    <th scope="col">Week ID</th>
                                    <th scope="col">Week Date</th>
                                    <th scope="col">Action</th>
                                </tr>
                            </thead>
                            <tbody class="week-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <!-- ... other .page sections for Category, Product, etc. styled similarly ... -->
         <!-- Ensure all .page divs have the card structure for consistency -->
    </div>
    
    <script src="../public/js/jquery.js"></script>
    <script src="../public/js/bootstrap.bundle.min.js"></script>
    <script src="../public/js/clock.js"></script>
    <script src="../public/js/admin.js"></script>
    <script>
    $(document).ready(function() {
        // Fetch admin name (or use session data if available directly)
        // This assumes you have a way to get the admin's name.
        // For now, hardcoding or leaving as "Admin"
        // $('#adminName').text('MAHESH'); // Or fetch dynamically

        // Fetch and display current week
        $.ajax({
            url: '../knft/getLastWeek.php',
            type: 'GET',
            dataType: 'json',
            success: function(response) {
                if (response && response.length > 0 && response[0].weekdate) {
                    $('#currentWeekDisplay').text(response[0].weekdate + " (ID: " + response[0].weekID + ")");
                } else {
                    $('#currentWeekDisplay').text('Not Set');
                }
            },
            error: function() { $('#currentWeekDisplay').text('Error'); }
        });
        
        // Your existing admin.js AJAX calls for UOM, Category, etc. will populate the tables.
        // The removal of internal page headers is done via CSS rule now.
    });
    </script>
</body>
</html>